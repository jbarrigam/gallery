DROP TABLE TICKET_ITEM;
DROP TABLE TICKET;
DROP TABLE PAYMENT;
DROP TABLE FISCAL_ADDRESS;
DROP TABLE CURRENCY;
DROP TABLE PAYMENT_INFO;
DROP TABLE PRODUCT_ATTRVALUES;
DROP TABLE CATEGORY_ATTRVALUES;
DROP TABLE CATEGORY_ATTRIBUTE;
DROP TABLE PRODUCT;
DROP TABLE BRAND;
DROP TABLE CATEGORY;
DROP TABLE CLASS;
DROP TABLE FAMILY;
DROP TABLE SEGMENT;
DROP TABLE PAYMENT_TYPE;

CREATE TABLE TICKET_ITEM (
TICKET_ID INTEGER NOT NULL,
NUMESEQ INTEGER NOT NULL,
PRODUCT_ID INTEGER,
ITEM_DESCRIPTION VARCHAR(50),
QUANTITY INTEGER,
PRICE DECIMAL(10,4),
TAX DECIMAL(10,4),
PRIMARY KEY (TICKET_ID, NUMESEQ)
);

CREATE TABLE TICKET (
TICKET_ID INTEGER NOT NULL,
TIMEPLACED TIMESTAMP NOT NULL,
FISCAL_ADDRESS_ID INTEGER NOT NULL,
TOTAL_REVENUE DECIMAL(10,4),
TOTAL_PRODUCTS DECIMAL(10,4),
TOTAL_TAX DECIMAL(10,4),
PAYMENT_ID INTEGER NOT NULL,
PRIMARY KEY (TICKET_ID)
);

CREATE TABLE FISCAL_ADDRESS (
FISCAL_ADDRESS_ID INTEGER NOT NULL,
ADDRESS VARCHAR(50),
NUMBER_FA SMALLINT,
CITY VARCHAR(25),
COUNTRY VARCHAR(25),
ZIP_CODE INTEGER,
PRIMARY KEY (FISCAL_ADDRESS_ID)
);

CREATE TABLE PAYMENT (
PAYMENT_ID INTEGER NOT NULL,
TYPE_CREDITCARD VARCHAR(3) NOT NULL,
CURRENCY_ID VARCHAR(3) NOT NULL,
EXPECTED_AMOUNT INTEGER,
APPROVED_AMOUNT INTEGER,
PAYMENT_INFO_ID INTEGER NOT NULL,
PRIMARY KEY (PAYMENT_ID)
);

CREATE TABLE CURRENCY (
CURRENCY_ID VARCHAR(3) NOT NULL,
CURRENCY_DESCRIPTION VARCHAR(25),
CURRENCY_EXCHANGERATE INTEGER,
PRIMARY KEY (CURRENCY_ID)
);

CREATE TABLE PAYMENT_INFO (
PAYMENT_INFO_ID INTEGER NOT NULL,
CARD_NUMBER INTEGER NOT NULL,
NAME_OWNER VARCHAR(50),
TIME_CREATED TIMESTAMP,
TIME_UPLOADED TIMESTAMP,
TIME_EXPIRED TIMESTAMP,
PRIMARY KEY (PAYMENT_INFO_ID)
);

ALTER TABLE TICKET_ITEM
ADD FOREIGN KEY (TICKET_ID)
REFERENCES TICKET(TICKET_ID);

ALTER TABLE TICKET
ADD FOREIGN KEY (FISCAL_ADDRESS_ID)
REFERENCES FISCAL_ADDRESS(FISCAL_ADDRESS_ID);

ALTER TABLE TICKET
ADD FOREIGN KEY (PAYMENT_ID)
REFERENCES PAYMENT(PAYMENT_ID);

ALTER TABLE PAYMENT
ADD FOREIGN KEY (PAYMENT_INFO_ID)
REFERENCES PAYMENT_INFO(PAYMENT_INFO_ID);

ALTER TABLE PAYMENT
ADD FOREIGN KEY (CURRENCY_ID)
REFERENCES CURRENCY(CURRENCY_ID);


CREATE TABLE PRODUCT (
PRODUCT_ID INTEGER NOT NULL PRIMARY KEY,
CATEGORY_ID INTEGER NOT NULL,
PRODUCT_NAME VARCHAR(25) NOT NULL,
PROMOTION_CODE VARCHAR(15),
SIZE_CODE CHAR(3),
WEIGHT_CODE CHAR(3),
BRAND_ID INTEGER NOT NULL,
PRODUCT_DESCRIPTION VARCHAR(100)
);

CREATE TABLE CATEGORY (
CATEGORY_ID INTEGER NOT NULL PRIMARY KEY,
CATEGORY_NAME VARCHAR(25) NOT NULL,
CATEGORY_DESCRIPTION VARCHAR(100),
CLASS_ID INTEGER NOT NULL
);

CREATE TABLE CLASS (
CLASS_ID INTEGER NOT NULL PRIMARY KEY,
CLASS_NAME VARCHAR(25) NOT NULL,
CLASS_DESCRIPTION VARCHAR(100),
FAMILY_ID INTEGER NOT NULL
);

CREATE TABLE FAMILY (
FAMILY_ID INTEGER NOT NULL PRIMARY KEY,
FAMILY_NAME VARCHAR(25) NOT NULL,
FAMILY_DESCRIPTION VARCHAR(200),
SEGMENT_ID INTEGER NOT NULL
);

CREATE TABLE SEGMENT (
SEGMENT_ID INTEGER NOT NULL PRIMARY KEY,
SEGMENT_NAME VARCHAR(25) NOT NULL,
SEGMENT_DESCRIPTION VARCHAR(100)
);

CREATE TABLE BRAND (
BRAND_ID INTEGER NOT NULL PRIMARY KEY,
BRAND_NAME VARCHAR(25) NOT NULL,
BRAND_DESCRIPTION VARCHAR(100)
);

ALTER TABLE PRODUCT
ADD FOREIGN KEY (CATEGORY_ID)
REFERENCES CATEGORY(CATEGORY_ID);

ALTER TABLE PRODUCT
ADD FOREIGN KEY (BRAND_ID)
REFERENCES BRAND(BRAND_ID);

ALTER TABLE CATEGORY
ADD FOREIGN KEY (CLASS_ID)
REFERENCES CLASS(CLASS_ID);

ALTER TABLE CLASS
ADD FOREIGN KEY (FAMILY_ID)
REFERENCES FAMILY(FAMILY_ID);

ALTER TABLE FAMILY
ADD FOREIGN KEY (SEGMENT_ID)
REFERENCES SEGMENT(SEGMENT_ID);

ALTER TABLE TICKET_ITEM
ADD FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCT(PRODUCT_ID);

CREATE TABLE CATEGORY_ATTRIBUTE (
ATTRIBUTE_ID INTEGER NOT NULL,
NAME_CATEGORY VARCHAR(50),
CATEGORY_ID INTEGER NOT NULL,
PRIMARY KEY (CATEGORY_ID, ATTRIBUTE_ID)
);

CREATE TABLE CATEGORY_ATTRVALUES (
ATTRVALUE_ID INTEGER NOT NULL,
VALUE_CATEGORY VARCHAR(50),
ATTRIBUTE_ID INTEGER NOT NULL,
CATEGORY_ID INTEGER NOT NULL,
PRIMARY KEY (CATEGORY_ID, ATTRIBUTE_ID, ATTRVALUE_ID)
);

CREATE TABLE PRODUCT_ATTRVALUES (
PRODUCT_ID INTEGER NOT NULL,
CATEGORY_ID INTEGER NOT NULL,
ATTRIBUTE_ID INTEGER NOT NULL,
ATTRVALUE_ID INTEGER NOT NULL,
PRIMARY KEY (CATEGORY_ID, ATTRIBUTE_ID, ATTRVALUE_ID, PRODUCT_ID)
);

ALTER TABLE CATEGORY_ATTRIBUTE
ADD FOREIGN KEY (CATEGORY_ID)
REFERENCES CATEGORY(CATEGORY_ID);

ALTER TABLE CATEGORY_ATTRVALUES
ADD FOREIGN KEY (CATEGORY_ID, ATTRIBUTE_ID)
REFERENCES CATEGORY_ATTRIBUTE(CATEGORY_ID, ATTRIBUTE_ID);

ALTER TABLE PRODUCT_ATTRVALUES
ADD FOREIGN KEY (CATEGORY_ID, ATTRIBUTE_ID, ATTRVALUE_ID)
REFERENCES CATEGORY_ATTRVALUES(CATEGORY_ID, ATTRIBUTE_ID, ATTRVALUE_ID);

ALTER TABLE PRODUCT_ATTRVALUES
ADD FOREIGN KEY (PRODUCT_ID)
REFERENCES PRODUCT(PRODUCT_ID);

CREATE TABLE PAYMENT_TYPE (
TYPE_CREDITCARD VARCHAR(3) NOT NULL,
DESCRIPTION_CARD VARCHAR(25),
PRIMARY KEY (TYPE_CREDITCARD)
);

ALTER TABLE PAYMENT
ADD FOREIGN KEY (TYPE_CREDITCARD)
REFERENCES PAYMENT_TYPE(TYPE_CREDITCARD);

Insert into CURRENCY values 
('EU','EURO', 1),
('DOL', 'DOLLAR', 0.90),
('STG', 'STERLING', 0.80);

Insert into PAYMENT_TYPE values
('MC', 'MASTERCARD'),
('VS', 'Visa'),
('DS','Discover'),
('AM', 'American Express'),
('DC', 'Diners Club'),
('BK', 'Other Bank Card'); 

Insert into PAYMENT_INFO values 
(10, 44556633, 'REEM', '2022-12-05 11:30:00', '2022-12-05 11:32:00', '2022-12-05 11:32:05'),
(11, 44577633,  'CRISINA', '2022-12-05 12:32:00', '2022-12-05 12:32:30', '2022-12-05 12:34:00'),
(12, 44556333, 'JOSE', '2022-12-05 15:35:00', '2022-12-05 15:37:10', '2022-12-05 15:39:00'),
(13, 44556666, 'FELIPE', '2022-12-05 12:42:00', '2022-12-05 12:42:20', '2022-12-05 12:43:00'),
(14, 44557777, 'PIERRE', '2022-12-05 10:59:00', '2022-12-05 10:59:13','2022-12-05 10:59:58'),
(15, 44558888, 'DAVID', '2022-12-05 14:31:00', '2022-12-05 14:32:00', '2022-12-05 14:32:09'),
(16, 44559999, 'MARIA', '2022-12-05 09:34:00', '2022-12-05 09:34:40', '2022-12-05 09:34:56'),
(17, 44566666, 'CLAUDIA', '2022-12-06 12:36:00', '2022-12-06 12:36:50', '2022-12-06 12:38:00'),
(18, 44551111, 'FRANCESCO', '2022-12-06 13:38:00', '2022-12-06 13:38:10', '2022-12-06 13:39:00'),
(19, 44552222, 'JORGE', '2022-12-06 11:40:00', '2022-12-06 11:40:20', '2022-12-06 11:41:00'),
(20, 44552221, 'MARIA', '2022-12-06 13:32:30', '2022-12-06 13:33:00', '2022-12-06 13:33:10'),
(21, 44552223, 'EDOARDO', '2022-12-07 11:32:30', '2022-12-07 11:32:50','2022-12-07 11:33:10'),
(22, 44552224, 'ALEX', '2022-12-07 12:32:50', '2022-12-07 12:33:00', '2022-12-07 12:33:40'),
(23, 44552225, 'MAHA', '2022-12-07 13:21:00', '2022-12-07 13:22:00','2022-12-07 13:22:15'),
(24, 44552226, 'YARA', '2022-12-08 13:30:00', '2022-12-08 13:32:00', '2022-12-08 13:34:00'),
(25, 44552227, 'TRISTIAN', '2022-12-08 15:00:00', '2022-12-08 15:03:00', '2022-12-08 15:03:45');

Insert into PAYMENT values 
(100, 'MC', 'EU', 150, 150, 10),
(101, 'MC', 'EU', 100, 100, 11),
(102, 'MC', 'DOL', 50, 50 , 12),
(103, 'MC', 'STG', 200, 200, 13),
(104, 'VS', 'STG', 250, 250, 14),
(105, 'VS', 'EU', 300, 300, 15),
(106, 'VS', 'EU', 350, 350, 16),
(107, 'VS', 'DOL', 400, 400, 17),
(108, 'AM', 'DOL', 450, 450, 18),
(109, 'AM', 'STG', 500, 500, 19),
(110, 'AM', 'EU', 550, 550, 20),
(111, 'AM', 'DOL', 600, 600, 21),
(112, 'AM', 'DOL', 650, 650, 22),
(113, 'AM', 'STG', 700, 700, 23),
(114, 'AM', 'STG', 750, 750, 24),
(115, 'VS', 'DOL', 800, 800, 25);

Insert into FISCAL_ADDRESS values
(1, 'CALLE VELAQUEZ', 130, 'MADRID', 'SPAIN', 28001);  

Insert into BRAND values 
(3001, 'ASTURIANA', 'MILK COMPANY'),
(3002, 'TULIPAN' ,'MILK COMPANY'),
(3003, 'DELAMERE' ,'MILK COMPANY'),
(3004, 'COBREROS' ,'MILK COMPANY'),
(3005, 'SAN CASSIANO', 'MILK COMPANY'),
(3006, 'CARREFOUR', 'IPERMARKET'),
(3007, 'GARCIA BAQUERO', 'CHEESE COMPANY'),
(3008, 'HARZINGER', 'MILK COMPANY'),
(3009, 'PULEVA', 'MILK COMPANY'),
(3010, 'GRAN CAPITAN', 'CHEESE COMPANY');

Insert into SEGMENT values 
(50000000, 'FOOD/BEVARAGE/TOBACCO', NULL); 

Insert into FAMILY values 
(50130000, 'MILK/BUTTER/CHEESE/OTHERS', NULL, 50000000);

Insert into CLASS values 
(50131700, 'MILK', 'MILK SUBSTITUTES', 50130000),
(50131900, 'BUTTER', 'BUTTER SUBSTITUTES', 50130000),
(50131800, 'CHEESE', 'CHEESE SUBSTITUTES', 50130000); 

Insert into CATEGORY values 
(10000025, 'MILK PERISHABLE', NULL, 50131700),
(10000168, 'BUTTER PERISHABLE', NULL, 50131900),
(10006982, 'MARGARINE PERISHABLE', NULL, 50131900),
(10000028, 'CHEESE PERISHABLE', NULL, 50131800);

Insert into TICKET values 
(300, '2022-12-05 11:30:00', 1, 41.4, 37.26,  4.14, 100),
(301, '2022-12-05 11:32:00', 1, 5.07, 4.563,  0.507, 101),
(302, '2022-12-05 11:39:00', 1, 36.1,  32.49,  3.61, 102),
(303, '2022-12-05 11:42:00', 1, 46.95, 42.255,  4.695, 103),
(304, '2022-12-05 11:59:00', 1, 42.25, 38.025,  4.225, 104),
(305, '2022-12-05 12:32:00', 1, 20.04, 18.036,  2.004, 105),
(306, '2022-12-05 12:34:00', 1, 8.55, 7.695,  0.855, 106),
(307, '2022-12-06 12:36:00', 1, 29.5,  26.55,  2.95, 107),
(308, '2022-12-06 12:38:00', 1, 23.6,  21.24,  2.36, 108),
(309, '2022-12-06 12:40:00', 1, 6.76, 6.084,  0.676, 109),
(310, '2022-12-06 13:32:00', 1, 8.55, 7.695,  0.855, 110),
(311, '2022-12-07 10:32:00', 1, 5.4,  4.86,  0.54, 111),
(312, '2022-12-07 11:32:00', 1, 35.97, 32.373,  3.597, 112),
(313, '2022-12-07 12:22:00', 1, 8.55, 7.695,  0.855, 113),
(314, '2022-12-08 13:30:00', 1, 12.75, 11.475,  1.275, 114),
(315, '2022-12-08 14:00:00', 1, 10.5,  9.45,  1.05, 115);

Insert into PRODUCT values
(1000, 10000025, 'Not Organic Milk', NULL, NULL, NULL, 3009, 'Milk perishable not organic milk'),
(1001, 10000025, 'Organic Whole Milk', NULL, NULL, NULL, 3001, 'Milk perishable organic milk'),
(1002, 10000168, 'Goat Butter', NULL, NULL, NULL, 3003, 'Goat source butter persishable'),
(1003, 10000168, 'Cow Butter', NULL, NULL, NULL, 3002, 'Cow source butter persishable'),
(1004, 10000168, 'Pig Butter', NULL, NULL, NULL, 3002, 'Pig source butter persishable'),
(1005, 10000168, 'Sheep Butter', NULL, NULL, NULL, 3003, 'Sheep source butter persishable'),
(1006, 10006982, 'Margarine Deluxe', NULL, NULL, NULL, 3002, 'Herb Ingredient margarine persishable'),
(1007, 10006982, 'Cooking Margarine', NULL, NULL, NULL, 3002, 'Salt Ingredient margarine persishable'),
(1008, 10006982, 'Margarine Carrefour', NULL, NULL, NULL, 3006, 'Combination Ingredient margarine persishable'),
(1009, 10000028, 'Blended cheese roulé made', NULL, NULL, NULL, 3004, 'Perishable Blended Cheese'),
(1010, 10000028, 'Parmigiano cream cheese', NULL, NULL, NULL, 3005, 'Perishable Cream Cheese'),
(1011, 10000028, 'Semi-hard cheese', NULL, NULL, NULL, 3010, 'Perishable Semi-hard Cheese'),
(1012, 10000028, 'Semi-soft cheese', NULL, NULL, NULL, 3007, 'Perishable Semi-soft Cheese'),
(1013, 10000028, 'Quark sour milk cheese', NULL, NULL, NULL, 3008, 'Perishable Sour Milk Cheese');

Insert into CATEGORY_ATTRIBUTE values 
(20000142, 'IF ORGANIC', 10000025),
(20000163, 'SOURCE', 10000168),
(20000002, 'ADDED INGREDIENT', 10006982),
(20003081, 'KIND OF CHEESE', 10000028);

Insert into CATEGORY_ATTRVALUES values
(30002960, 'NO', 20000142, 10000025),
(30002654, 'YES', 20000142, 10000025),
(30001131, 'GOAT', 20000163,10000168),
(30000785, 'COW', 20000163, 10000168),
(30006939, 'PIG', 20000163, 10000168),
(30002203, 'SHEEP', 20000163, 10000168),
(30001096, 'GARLIC', 20000002, 10006982),
(30001253, 'HERB', 20000002, 10006982),
(30002103, 'SALT', 20000002, 10006982),
(30000720, 'COMBINATION', 20000002, 10006982),
(30018361, 'BLENDED CHEESE', 20003081, 10000028),
(30000799, 'CREAM CHEESE', 20003081, 10000028),
(30017982, 'SEMI-HARD CHEESE', 20003081, 10000028),
(30017983, 'SEMI-SOFT CHEESE', 20003081, 10000028),
(30017985, 'SOUR MILK CHEESE', 20003081, 10000028);
 
Insert into PRODUCT_ATTRVALUES values
(1000, 10000025, 20000142, 30002960),
(1001, 10000025, 20000142, 30002960),
(1002, 10000168, 20000163, 30001131),
(1003, 10000168, 20000163, 30001131),
(1004, 10000168, 20000163, 30001131),
(1005, 10000168, 20000163, 30001131),
(1006, 10006982, 20000002, 30001096),
(1007, 10006982, 20000002, 30001096),
(1008, 10006982, 20000002, 30001096),
(1009, 10000028, 20003081, 30018361),
(1010, 10000028, 20003081, 30018361),
(1011, 10000028, 20003081, 30018361),
(1012, 10000028, 20003081, 30018361),
(1013, 10000028, 20003081, 30018361);

Insert into TICKET_ITEM values
(300,1,1010,NULL,2,8.9,0.89),
(301,2,1001,NULL,3,1.69,0.169),
(302,3,1008,NULL,5,2.5,0.25),
(303,4,1010,NULL,4,8.9,0.89),
(304,5,1011,NULL,2,4.25,0.425),
(305,6,1007,NULL,4,1.8,0.18),
(306,7,1003,NULL,3,2.85,0.285),
(307,8,1004,NULL,5,5.9,0.59),
(308,9,1004,NULL,4,5.9,0.59),
(309,10,1001,NULL,4,1.69,0.169),
(310,11,1003,NULL,3,2.85,0.285),
(311,12,1007,NULL,3,1.8,0.18),
(312,13,1002,NULL,3,11.99,1.199),
(313,14,1003,NULL,3,2.85,0.285),
(314,15,1011,NULL,3,4.25,0.425),
(315,16,1013,NULL,5,2.1,0.21),
(300,17,1004,NULL,4,5.9,0.59),
(302,18,1004,NULL,4,5.9,0.59),
(303,19,1007,NULL,5,1.8,0.18),
(304,20,1009,NULL,3,2.35,0.235),
(305,21,1012,NULL,1,5.34,0.534),
(303,22,1009,NULL,1,2.35,0.235),
(304,23,1012,NULL,5,5.34,0.534),
(305,24,1008,NULL,3,2.5,0.25);
